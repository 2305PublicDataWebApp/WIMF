<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="CareMapper">
	<resultMap id="CareResultMap" type="Care">
	    <result property="userNickName" column="USER_NICKNAME"/>
	</resultMap>
	<!-- 게시글 등록 -->
	<insert id="insertCare">
		INSERT INTO CARE_TBL VALUES(CARE_NO_SEQ.NEXTVAL, #{careTitle}, #{careContent}, #{careWriter}, DEFAULT, DEFAULT, DEFAULT)
	</insert>
	<!-- 게시글 수정 -->
	<update id="updateCare">
		UPDATE CARE_TBL SET CARE_TITLE = #{careTitle}, CARE_CONTENT = #{careContent}, UPDATE_DATE = DEFAULT WHERE CARE_NO = #{careNo}
	</update>
	<!-- 게시글 삭제 -->
	<select id="deleteCare">
		DELETE FROM CARE_TBL WHERE CARE_NO = #{careNo}
	</select>
	<!-- 게시글 리스트 조회 -->
<!-- 	<select id="selectCareList" resultType="Care"> -->
<!-- 		SELECT * FROM CARE_TBL ORDER BY CARE_NO DESC -->
<!-- 	</select> -->
	<!-- 게시글 리스트 조회 -->
	<select id="selectCareList" resultType="Care" resultMap="CareResultMap">
		SELECT CARE_TBL.*, USER_TBL.USER_NICKNAME
	    FROM CARE_TBL
	    LEFT JOIN USER_TBL ON CARE_TBL.CARE_WRITER = USER_TBL.USER_ID
	    ORDER BY CARE_TBL.CARE_NO DESC
	</select>
	<!-- 게시글 상세조회 -->
	<select id="selectOneByCare" resultType="Care">
		SELECT * FROM CARE_TBL WHERE CARE_NO = #{careNo}
	</select>
	<!-- 게시글 조회수 증가 -->
	<update id="increaseViewCount">
		UPDATE CARE_TBL SET VIEW_COUNT = VIEW_COUNT + 1 WHERE CARE_NO = #{careNo}
	</update>
	<!-- 단체 게시글 갯수 -->
	<select id="selectListCount" resultType="_int">
		SELECT COUNT(*) FROM CARE_TBL
	</select>
	<!-- 게시글 수정 페이지 -->
	<select id="selectCareByNo" resultType="Care">
		SELECT * FROM CARE_TBL WHERE CARE_NO = #{careNo}
	</select>
	<!-- 게시글 키워드 검색 -->
	<select id="selectCareByKeyword" resultType="Care">
		SELECT CARE_TBL.*, USER_TBL.USER_NICKNAME
	    FROM CARE_TBL
	    LEFT JOIN USER_TBL ON CARE_TBL.CARE_WRITER = USER_TBL.USER_ID 
		<if test="searchCondition == 'all'">
		WHERE USER_TBL.USER_NICKNAME LIKE '%'||#{searchKeyword}||'%' OR CARE_TBL.CARE_TITLE LIKE '%'||#{searchKeyword}||'%' OR CARE_TBL.CARE_CONTENT LIKE '%'||#{searchKeyword}||'%'
		ORDER BY CARE_TBL.CARE_NO DESC
		</if>
		<if test="searchCondition == 'writer'">
		WHERE USER_TBL.USER_NICKNAME LIKE '%'||#{searchKeyword}||'%'
		ORDER BY CARE_TBL.CARE_NO DESC
		</if>
		<if test="searchCondition == 'title'">
		WHERE CARE_TBL.CARE_TITLE LIKE '%'||#{searchKeyword}||'%'
		ORDER BY CARE_TBL.CARE_NO DESC
		</if>
		<if test="searchCondition == 'content'">
		WHERE CARE_TBL.CARE_CONTENT LIKE '%'||#{searchKeyword}||'%'
		ORDER BY CARE_TBL.CARE_NO DESC
		</if>
	</select>
	<!-- 키워드 제목으로 검색 -->
	<select id="selectCareByTitle" resultType="Care">
		SELECT * FROM CARE_TBL WHERE CARE_TITLE LIKE '%'||#{searchKeyword}||'%'
	</select>
	<!-- 키워드 작성자로 검색 -->
<!-- 	<select id="searchCareByWriter" resultType="Care"> -->
<!-- 		SELECT * FROM CARE_TBL WHERE CARE_WRITER LIKE '%'||#{searchKeyword}||'%' -->
<!-- 	</select> -->
	<!-- 키워드 작성자로 검색 -->
	<select id="searchCareByWriter" resultType="Care" resultMap="CareResultMap" parameterType="String">
		SELECT CARE_TBL.*, USER_TBL.USER_NICKNAME
	    FROM CARE_TBL
	    LEFT JOIN USER_TBL ON CARE_TBL.CARE_WRITER = USER_TBL.USER_ID
	    WHERE USER_TBL.USER_NICKNAME LIKE '%'||#{searchKeyword}||'%'
	    ORDER BY CARE_TBL.CARE_NO DESC
	</select>
	<!-- 키워드 내용으로 검색 -->
	<select id="searchCareByContent" resultType="Care">
		SELECT * FROM CARE_TBL WHERE CARE_CONTENT LIKE '%'||#{searchKeyword}||'%'
	</select>
	<!-- 키워드 전체 검색 -->
	<select id="searchCareByAll" resultType="Care">
		SELECT * FROM CARE_TBL WHERE CARE_TITLE LIKE '%'||#{searchKeyword}||'%' OR CARE_CONTENT LIKE '%'||#{searchKeyword}||'%' OR CARE_WRITER LIKE '%'||#{searchKeyword}||'%'
	</select>
</mapper>